<link rel="import" href="./bower_components/polymer/polymer.html">
<link rel="import" href="./bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="./bower_components/paper-toast/paper-toast.html">

<dom-module id="post-service">
  <style>
  :host {
    display: none;
  }
  </style>
  <template>
    <iron-ajax id="ajax"
      auto
      url="/inventory-item"
      on-response="postsLoaded"
      last-request="{{posts}}"
      handleAs="json">
    </iron-ajax>
    <iron-ajax id="ajaxpost"
      method="post"
      contentType="application/json"
      on-response="update"
      url="/inventory-item">
    </iron-ajax>
  </template>
</dom-module>

<script>
Polymer({
  is: "post-service",
  properties: {
    posts: Array,
  },
  created: function() {

    },
  postsLoaded: function(request) {
    // Make a copy of the loaded data
    //console.log(request.detail.response);
    this.posts = request.detail.response.slice(0);
    this.fire('ajax-data-received', {posts: this.posts});
  },
  update: function() {
    //console.log('updated');
    this.fire('ajax-data-received');
    console.log('ajax data received: ');
    //this.$.ajax.go();
  },
  saveTransaction: function(userid, count, price) {
    var ajax = this.$.ajaxpost;
    ajax.url="/transactions";
    ajax.method="post";
    var newTransaction = {};
    newTransaction.userid = userid;
    newTransaction.count = count;
    newTransaction.price = price;
    ajax.body = JSON.stringify(newTransaction);
    ajax.go();
    //console.log('Favorite changed: ' + id + ", now: " + isFavorite);
  }
});
</script>
